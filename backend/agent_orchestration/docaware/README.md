# DocAware Agent Implementation\n\n## Overview\n\nThe DocAware functionality enables agents in the workflow to search and retrieve relevant documents from the project's vector database during conversation execution. This implementation provides a comprehensive RAG (Retrieval-Augmented Generation) capability with multiple search methods and configurable parameters.\n\n## Architecture\n\n### Backend Components\n\n#### 1. DocAware Search Methods (`docaware/search_methods.py`)\n- **SearchMethod Enum**: Defines available search methods\n- **SearchMethodConfig**: Configuration class for each search method\n- **DocAwareSearchMethods**: Registry of available search methods and validation\n\n**Available Search Methods:**\n- `SEMANTIC_SEARCH`: Vector similarity search using embeddings\n- `HYBRID_SEARCH`: Combines semantic search with keyword filtering\n- `KEYWORD_SEARCH`: Traditional keyword-based search with BM25 scoring\n- `CONTEXTUAL_SEARCH`: Search with conversation context awareness\n- `SIMILARITY_THRESHOLD`: Returns all results above similarity threshold\n- `MULTI_COLLECTION`: Search across multiple document collections\n- `HIERARCHICAL_SEARCH`: Document hierarchy-aware search\n\n#### 2. Enhanced DocAware Service (`docaware/service.py`)\n- **EnhancedDocAwareAgentService**: Main service class for document search\n- Integrates with Django Milvus Search package\n- Supports multiple search methods with parameter validation\n- Provides conversation context extraction and query optimization\n\n#### 3. Embedding Service (`docaware/embedding_service.py`)\n- **DocAwareEmbeddingService**: Handles text-to-vector conversion\n- Supports contextualized embeddings for better search results\n- Uses SentenceTransformers for embedding generation\n\n#### 4. API Views (`docaware_views.py`)\n- **DocAwareConfigViewSet**: REST API endpoints for DocAware configuration\n- Endpoints for search methods, parameter validation, and testing\n\n#### 5. Conversation Orchestrator Integration\n- Enhanced `ConversationOrchestrator` with DocAware capabilities\n- Automatic document context injection for DocAware-enabled agents\n- Support for both single and multi-input agent scenarios\n\n### Frontend Components\n\n#### 1. DocAware Service (`docAwareService.ts`)\n- Frontend service for DocAware API interactions\n- Handles search method loading and parameter validation\n- Provides testing functionality for search configurations\n\n#### 2. Node Properties Panel Enhancement\n- DocAware toggle for applicable agent types\n- Dynamic search method selection dropdown\n- Parameter configuration UI based on selected search method\n- Real-time search testing with sample results\n\n## Usage Flow\n\n### 1. Agent Configuration\n1. User selects an agent (AssistantAgent, UserProxyAgent, or DelegateAgent)\n2. User enables the \"DocAware\" toggle in the agent properties panel\n3. User selects a search method from the dropdown\n4. User configures method-specific parameters\n5. User can test the search configuration to verify it works\n\n### 2. Workflow Execution\n1. During workflow execution, DocAware-enabled agents automatically:\n   - Extract search queries from conversation history\n   - Retrieve relevant documents using configured search method\n   - Include document context in the agent's prompt\n   - Generate responses informed by the retrieved documents\n\n### 3. Search Methods Detail\n\n#### Semantic Search\n- Uses vector embeddings for semantic similarity\n- Parameters: index_type, metric_type, search_limit, relevance_threshold\n- Best for: Finding conceptually similar content\n\n#### Hybrid Search\n- Combines semantic search with keyword filtering\n- Parameters: keyword_weight, filter_expression\n- Best for: Balanced semantic and exact match results\n\n#### Contextual Search\n- Incorporates conversation context into search\n- Parameters: context_window, context_weight\n- Best for: Conversation-aware document retrieval\n\n#### Similarity Threshold\n- Returns all results above a specific similarity score\n- Parameters: similarity_threshold, max_results\n- Best for: Finding all highly relevant documents\n\n## Configuration Examples\n\n### Basic Semantic Search\n```json\n{\n  \"doc_aware\": true,\n  \"search_method\": \"semantic_search\",\n  \"search_parameters\": {\n    \"index_type\": \"HNSW\",\n    \"metric_type\": \"COSINE\",\n    \"search_limit\": 5,\n    \"relevance_threshold\": 0.7\n  }\n}\n```\n\n### Hybrid Search with Keywords\n```json\n{\n  \"doc_aware\": true,\n  \"search_method\": \"hybrid_search\",\n  \"search_parameters\": {\n    \"index_type\": \"AUTOINDEX\",\n    \"metric_type\": \"COSINE\",\n    \"search_limit\": 10,\n    \"keyword_weight\": 0.3,\n    \"filter_expression\": \"document_type == 'pdf'\"\n  }\n}\n```\n\n### Contextual Search\n```json\n{\n  \"doc_aware\": true,\n  \"search_method\": \"contextual_search\",\n  \"search_parameters\": {\n    \"context_window\": 3,\n    \"context_weight\": 0.4,\n    \"search_limit\": 8,\n    \"relevance_threshold\": 0.6\n  }\n}\n```\n\n## API Endpoints\n\n### Search Methods\n- `GET /api/projects/{id}/agent-orchestration/docaware/search_methods/`\n- Returns available search methods and their configurations\n\n### Parameter Validation\n- `POST /api/projects/{id}/agent-orchestration/docaware/validate_parameters/`\n- Validates search method parameters\n\n### Test Search\n- `POST /api/projects/{id}/agent-orchestration/docaware/test_search/`\n- Tests search functionality with given parameters\n\n### Collections\n- `GET /api/projects/{id}/agent-orchestration/docaware/collections/`\n- Returns available document collections for the project\n\n## Integration Points\n\n### 1. Milvus Vector Database\n- Uses existing Django Milvus Search package\n- Leverages optimized algorithms and connection pooling\n- Supports multiple collection types and index configurations\n\n### 2. Project Document Collections\n- Automatically detects project-specific collections\n- Uses project-based collection naming convention\n- Supports cross-collection search for advanced scenarios\n\n### 3. Conversation Context\n- Extracts queries from conversation history\n- Maintains conversation context for contextual search\n- Integrates seamlessly with existing workflow execution\n\n## Performance Considerations\n\n### 1. Embedding Generation\n- Uses efficient SentenceTransformers models\n- Supports batch processing for multiple queries\n- Caches embeddings where appropriate\n\n### 2. Search Optimization\n- Leverages Milvus indexing for fast vector search\n- Supports different index types for various use cases\n- Configurable result limits to control response time\n\n### 3. Context Management\n- Intelligent query extraction from conversation history\n- Configurable context windows for optimal performance\n- Automatic context cleanup and optimization\n\n## Error Handling\n\n### 1. Graceful Degradation\n- Agents continue to function if DocAware fails\n- Clear error messages for configuration issues\n- Fallback to non-DocAware mode when necessary\n\n### 2. Validation\n- Parameter validation before search execution\n- Real-time testing capability for configuration\n- Clear feedback for invalid configurations\n\n### 3. Logging\n- Comprehensive logging for debugging\n- Performance metrics tracking\n- Error reporting and analysis\n\n## Future Enhancements\n\n### 1. Advanced Search Methods\n- Graph-based search for document relationships\n- Temporal search for time-sensitive queries\n- Multi-modal search supporting images and text\n\n### 2. AI-Powered Query Enhancement\n- Automatic query expansion and refinement\n- Intent detection for better search targeting\n- Learning from user interactions\n\n### 3. Performance Optimization\n- Async search processing for better responsiveness\n- Smart caching for frequently accessed documents\n- Distributed search across multiple collections\n\n## Testing\n\nRun the DocAware integration test:\n```bash\ncd /Users/alok/Documents/AICC/ai_catalogue/ai_catalogue\npython test_docaware.py\n```\n\nThis will test:\n- Search method loading\n- Parameter validation\n- Service initialization\n- Basic functionality verification\n